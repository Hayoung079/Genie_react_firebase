{"ast":null,"code":"import firebase from \"firebase\";\nimport \"firebase/auth\";\nimport \"firebase/firestore\";\nimport Counter from './Counter'; // import uuid from \"react-uuid\";\n//uuid 활용\n//window.sessionStorage.setItem(\"userId\", uuid());\n// Your web app's Firebase configuration\n// For Firebase JS SDK v7.20.0 and later, measurementId is optional\n\nvar firebaseConfig = {\n  apiKey: \"AIzaSyBptMJhUc4gjRfOHNYhybCgfQO5YQLdP3E\",\n  authDomain: \"reactfirebase-30c10.firebaseapp.com\",\n  databaseURL: \"https://reactfirebase-30c10-default-rtdb.firebaseio.com\",\n  projectId: \"reactfirebase-30c10\",\n  storageBucket: \"reactfirebase-30c10.appspot.com\",\n  messagingSenderId: \"440103573360\",\n  appId: \"1:440103573360:web:715853e90fb1563a8a61b5\",\n  measurementId: \"G-S9BB5XF3JP\"\n}; // Initialize Firebase\n\nfirebase.initializeApp(firebaseConfig);\nlet number = []; // 숫자를 넣어 중복을 확인할 배열\n\nlet localNum = window.localStorage.getItem(\"ranNum\");\n\nif (!localNum) {\n  window.localStorage.setItem(\"ranNum\", JSON.stringify(number));\n} else {\n  number = JSON.parse(localNum);\n} // userId 중복없이 랜덤숫자 생성 \n\n\nconst random = () => {\n  back: while (true) {\n    let ranNum = Math.floor(Math.random() * 20 + 1); //1~20까지 숫자\n\n    if (number.indexOf(ranNum) === -1) {\n      // 중복숫자가 없으면\n      number.push(ranNum);\n      window.localStorage.setItem(\"ranNum\", JSON.stringify(number)); // 로컬스토리지에 숫자배열 저장\n\n      break;\n    } else {\n      // 있으면 다시 숫자 뽑기\n      continue back;\n    }\n  }\n}; // 데이터 쓰기\n\n\nconst CreateUser = (userName, userPhone) => {\n  const userIdArr = JSON.parse(window.localStorage.getItem(\"ranNum\"));\n  const userId = userIdArr[userIdArr.length - 1];\n  const userListRef = firebase.database().ref('Users');\n  const newUserRef = userListRef.child('User' + userId);\n  newUserRef.set({\n    userId: JSON.parse(userId),\n    userName: userName,\n    userPhone: userPhone\n  });\n}; // 숫자 버튼 클릭시 업데이트\n\n\n_c = CreateUser;\n\nconst UpdateNum = num => {\n  const userIdArr = JSON.parse(window.localStorage.getItem(\"ranNum\"));\n  const userId = userIdArr[userIdArr.length - 1];\n  console.log(userId);\n  firebase.database().ref('Users').child('User' + userId).update({\n    count: num\n  });\n};\n\n_c2 = UpdateNum;\n\nconst UpdateNumLogin = (userId, num) => {\n  console.log(userId);\n  firebase.database().ref('Users').child('User' + userId).update({\n    count: num\n  });\n}; // // 데이터 읽기 -- 중복 회원가입 안 되게\n\n\n_c3 = UpdateNumLogin;\n\nconst ReadUser = (userName, userPhone) => {\n  //휴대폰 번호로 판단\n  random();\n  const phoneRef = firebase.database().ref('Users').orderByChild('userPhone').equalTo(userPhone);\n  phoneRef.once(\"value\", function (snapshot) {\n    if (snapshot.exists()) {\n      console.log(\"exists!\"); // localStorage에 배열 마지막 값 삭제하기\n\n      number.pop();\n      window.localStorage.setItem(\"ranNum\", JSON.stringify(number));\n      alert(\"가입한 회원\"); // 일치하는 노드에 (userId) count++ 하기\n\n      const userIdObj = snapshot.val()[Object.keys(snapshot.val())[0]];\n      const userCount = userIdObj[Object.keys(userIdObj)[0]];\n      const userId = userIdObj[Object.keys(userIdObj)[1]];\n      console.log(\"Local :\" + userId, userCount);\n      window.sessionStorage.setItem(\"UserID\", userId);\n      window.sessionStorage.setItem(\"CurrentCount\", userCount);\n      Counter();\n    } else {\n      console.log(\"not exists!\");\n      CreateUser(userName, userPhone);\n      window.sessionStorage.setItem(\"CurrentCount\", 0);\n      Counter();\n    }\n  });\n}; // 필요한 곳에서 사용할 수 있도록 내보내기\n\n\n_c4 = ReadUser;\nexport { CreateUser, UpdateNum, ReadUser, UpdateNumLogin };\n\nvar _c, _c2, _c3, _c4;\n\n$RefreshReg$(_c, \"CreateUser\");\n$RefreshReg$(_c2, \"UpdateNum\");\n$RefreshReg$(_c3, \"UpdateNumLogin\");\n$RefreshReg$(_c4, \"ReadUser\");","map":{"version":3,"sources":["C:/Users/Genie/Desktop/Genie_react_firebase/src/Firebase.js"],"names":["firebase","Counter","firebaseConfig","apiKey","authDomain","databaseURL","projectId","storageBucket","messagingSenderId","appId","measurementId","initializeApp","number","localNum","window","localStorage","getItem","setItem","JSON","stringify","parse","random","back","ranNum","Math","floor","indexOf","push","CreateUser","userName","userPhone","userIdArr","userId","length","userListRef","database","ref","newUserRef","child","set","UpdateNum","num","console","log","update","count","UpdateNumLogin","ReadUser","phoneRef","orderByChild","equalTo","once","snapshot","exists","pop","alert","userIdObj","val","Object","keys","userCount","sessionStorage"],"mappings":"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","sourcesContent":["import firebase from \"firebase\";\r\nimport \"firebase/auth\";\r\nimport \"firebase/firestore\";\r\nimport  Counter  from './Counter';\r\n// import uuid from \"react-uuid\";\r\n//uuid 활용\r\n//window.sessionStorage.setItem(\"userId\", uuid());\r\n\r\n// Your web app's Firebase configuration\r\n// For Firebase JS SDK v7.20.0 and later, measurementId is optional\r\nvar firebaseConfig = {\r\n  apiKey: \"AIzaSyBptMJhUc4gjRfOHNYhybCgfQO5YQLdP3E\",\r\n  authDomain: \"reactfirebase-30c10.firebaseapp.com\",\r\n  databaseURL: \"https://reactfirebase-30c10-default-rtdb.firebaseio.com\",\r\n  projectId: \"reactfirebase-30c10\",\r\n  storageBucket: \"reactfirebase-30c10.appspot.com\",\r\n  messagingSenderId: \"440103573360\",\r\n  appId: \"1:440103573360:web:715853e90fb1563a8a61b5\",\r\n  measurementId: \"G-S9BB5XF3JP\"\r\n};\r\n\r\n// Initialize Firebase\r\nfirebase.initializeApp(firebaseConfig);\r\n\r\nlet number = []; // 숫자를 넣어 중복을 확인할 배열\r\nlet localNum = window.localStorage.getItem(\"ranNum\");\r\n  \r\nif(!localNum){\r\n  window.localStorage.setItem(\"ranNum\", JSON.stringify(number));\r\n}else{\r\n  number = JSON.parse(localNum);\r\n}\r\n\r\n// userId 중복없이 랜덤숫자 생성 \r\nconst random = () => {   \r\n  \r\n  back:\r\n  while(true){\r\n    let ranNum = Math.floor(Math.random()*20+1); //1~20까지 숫자\r\n  \r\n    if(number.indexOf(ranNum) === -1){ // 중복숫자가 없으면\r\n      number.push(ranNum);\r\n      window.localStorage.setItem(\"ranNum\", JSON.stringify(number)); // 로컬스토리지에 숫자배열 저장\r\n      break;\r\n    }else{ // 있으면 다시 숫자 뽑기\r\n      continue back;\r\n    }\r\n  }\r\n}\r\n\r\n\r\n// 데이터 쓰기\r\nconst CreateUser = (userName, userPhone) => {\r\n  const userIdArr = JSON.parse(window.localStorage.getItem(\"ranNum\")) ;\r\n  const userId = userIdArr[userIdArr.length-1];\r\n  const userListRef = firebase.database().ref('Users');\r\n  const newUserRef = userListRef.child('User' + userId);\r\n  \r\n  newUserRef.set({\r\n    userId: JSON.parse(userId),\r\n    userName: userName,\r\n    userPhone: userPhone\r\n  });\r\n}\r\n\r\n\r\n// 숫자 버튼 클릭시 업데이트\r\nconst UpdateNum = (num) => {\r\n  const userIdArr = JSON.parse(window.localStorage.getItem(\"ranNum\")) ;\r\n  const userId = userIdArr[userIdArr.length-1];\r\n  console.log(userId)\r\n  firebase.database().ref('Users').child('User' + userId ).update({\r\n    count: num\r\n  });\r\n}\r\n\r\nconst UpdateNumLogin = (userId ,num) => {\r\n  console.log(userId)\r\n  firebase.database().ref('Users').child('User' + userId ).update({\r\n    count: num\r\n  });\r\n}\r\n\r\n\r\n// // 데이터 읽기 -- 중복 회원가입 안 되게\r\nconst ReadUser = (userName, userPhone) => { //휴대폰 번호로 판단\r\n  random();\r\n\r\n  const phoneRef = firebase.database().ref('Users').orderByChild('userPhone').equalTo(userPhone);\r\n  phoneRef.once(\"value\", function(snapshot){\r\n    if (snapshot.exists()){\r\n      console.log(\"exists!\");\r\n      // localStorage에 배열 마지막 값 삭제하기\r\n      number.pop();\r\n      window.localStorage.setItem(\"ranNum\", JSON.stringify(number));\r\n      alert(\"가입한 회원\")\r\n      \r\n      // 일치하는 노드에 (userId) count++ 하기\r\n      const userIdObj= snapshot.val()[Object.keys(snapshot.val())[0]];\r\n      const userCount = userIdObj[Object.keys(userIdObj)[0]];\r\n      const userId = userIdObj[Object.keys(userIdObj)[1]];\r\n      console.log(\"Local :\"+ userId, userCount);\r\n      \r\n      window.sessionStorage.setItem(\"UserID\", userId);\r\n      window.sessionStorage.setItem(\"CurrentCount\", userCount);\r\n      Counter();\r\n      \r\n    }else{\r\n      console.log(\"not exists!\");\r\n      CreateUser(userName, userPhone);\r\n      window.sessionStorage.setItem(\"CurrentCount\", 0);\r\n      Counter();\r\n    }\r\n  });\r\n}\r\n\r\n\r\n// 필요한 곳에서 사용할 수 있도록 내보내기\r\nexport {CreateUser, UpdateNum, ReadUser, UpdateNumLogin};\r\n"]},"metadata":{},"sourceType":"module"}